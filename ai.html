<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="blanklogo.png" type="image/x-icon" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Team ABH PK â€“ AI Chat</title>
  <style>
    /* CSS Styles */
    html, body { height: 100%; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
    body { background: #f5f7fa; color: #1f2937; }
    
    header {
      background: rgba(255,255,255,0.92);
      position: fixed; top: 0; width: 100%;
      display: flex; justify-content: space-between;
      padding: 1rem 2rem; box-shadow: 0 4px 20px rgba(80,100,144,0.10);
      z-index: 10;
    }
    
    .logo {
      font-weight: 700; font-size: 1.3rem;
      background: linear-gradient(90deg, #5de0e6, #8060e0);
      -webkit-background-clip: text; color: transparent;
    }
    
    .chat-container {
      margin-top: 80px;
      height: calc(100vh - 160px);
      max-width: 800px;
      margin: 80px auto 0;
      display: flex;
      flex-direction: column;
    }
    
    .chat-log {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
      background: #f7f9fc;
      border-radius: 8px 8px 0 0;
      border: 1px solid #e7ebf3;
    }
    
    .message {
      margin: 0.5rem 0;
      padding: 0.8rem 1rem;
      border-radius: 8px;
      max-width: 80%;
      word-break: break-word;
    }
    
    .user-message {
      background: #ece9fd;
      color: #8060e0;
      margin-left: auto;
    }
    
    .ai-message {
      background: #e6f6f9;
      color: #5de0e6;
    }
    
    .chat-input {
      display: flex;
      padding: 1rem;
      background: white;
      border-radius: 0 0 8px 8px;
      border: 1px solid #e7ebf3;
      border-top: none;
    }
    
    #user-input {
      flex: 1;
      padding: 0.8rem;
      border: 1px solid #e2e7f3;
      border-radius: 8px;
      resize: none;
    }
    
    #send-button {
      padding: 0.8rem 1.5rem;
      margin-left: 0.5rem;
      background: linear-gradient(90deg, #5de0e6, #8060e0);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .error-message {
      color: #ff6b6b;
      text-align: center;
      padding: 1rem;
    }
  </style>
</head>
<body>
  <header>
    <a href="index.html" style="text-decoration:none;"><div class="logo">Team ABH PK</div></a>
  </header>

  <div class="chat-container">
    <div class="chat-log" id="chat-log"></div>
    <div class="chat-input">
      <textarea id="user-input" placeholder="Type your message..." rows="1"></textarea>
      <button id="send-button" type="button">
        <span id="button-text">Send</span>
        <span id="button-spinner" class="loading" style="display: none;"></span>
      </button>
    </div>
  </div>

  <script>
    // DOM Elements
    const chatLog = document.getElementById('chat-log');
    const userInput = document.getElementById('user-input');
    const sendButton = document.getElementById('send-button');
    const buttonText = document.getElementById('button-text');
    const buttonSpinner = document.getElementById('button-spinner');

    // AI Model Instance
    let model;
    let isInitialized = false;

    // Initialize the AI
    async function initializeAI() {
      try {
        // First load the Google GenAI library if not already loaded
        if (!window.GoogleGenAI) {
          await loadScript('https://unpkg.com/@google/genai/dist/google-genai.umd.js');
        }

        // Check if library loaded successfully
        if (!window.GoogleGenAI) {
          throw new Error('Failed to load Google GenAI library');
        }

        const { GoogleGenAI } = window.GoogleGenAI;
        
        // Initialize with API key (NOTE: In production, use a backend service instead)
        const genAI = new GoogleGenAI({
          apiKey: "AIzaSyCfi0JMfht-xOf2_YvofY7ZMf3BHzQmg1A" // Replace with your actual API key
        });

        // Get the generative model
        model = await genAI.getGenerativeModel({
          model: "gemini-pro",
          generationConfig: {
            maxOutputTokens: 1000
          }
        });

        isInitialized = true;
        addMessage("AI: Hello! How can I help you today?", 'ai-message');
        
      } catch (error) {
        console.error('AI Initialization Error:', error);
        addMessage(`AI: Initialization failed - ${error.message}`, 'error-message');
        sendButton.disabled = true;
      }
    }

    // Helper function to load scripts dynamically
    function loadScript(src) {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = src;
        script.onload = resolve;
        script.onerror = reject;
        document.head.appendChild(script);
      });
    }

    // Add message to chat log
    function addMessage(text, className) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${className}`;
      messageDiv.textContent = text;
      chatLog.appendChild(messageDiv);
      chatLog.scrollTop = chatLog.scrollHeight;
    }

    // Handle user input
    async function handleUserInput() {
      const userMessage = userInput.value.trim();
      if (!userMessage || !isInitialized) return;

      // Add user message to chat
      addMessage(`You: ${userMessage}`, 'user-message');
      userInput.value = '';
      
      // Show loading state
      buttonText.textContent = 'Thinking...';
      buttonSpinner.style.display = 'inline-block';
      sendButton.disabled = true;

      try {
        // Generate AI response
        const result = await model.generateContent(userMessage);
        const response = await result.response;
        const text = await response.text();
        
        // Add AI response to chat
        addMessage(`AI: ${text}`, 'ai-message');
        
      } catch (error) {
        console.error('AI Error:', error);
        addMessage(`AI: Sorry, I encountered an error - ${error.message}`, 'error-message');
      } finally {
        // Reset UI
        buttonText.textContent = 'Send';
        buttonSpinner.style.display = 'none';
        sendButton.disabled = false;
      }
    }

    // Event Listeners
    sendButton.addEventListener('click', handleUserInput);
    userInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        handleUserInput();
      }
    });

    // Auto-resize textarea
    userInput.addEventListener('input', function() {
      this.style.height = 'auto';
      this.style.height = (this.scrollHeight) + 'px';
    });

    // Initialize when page loads
    window.addEventListener('DOMContentLoaded', initializeAI);
  </script>
</body>
</html>
